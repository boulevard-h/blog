---
title:  数据库原理第二章 关系型数据库
date: 2022-12-8 12:18:57
categories: 数据库系统原理
tags: [数据库]
mathjax: true
---

关系数据模型是E.F.Codd于1970年提出的一种**概念模型**

按照上一章介绍的，概念模型有三个要素：数据结构、数据操作，以及数据的完整性约束条件

本章的前三部分就介绍了这三个部分，然后介绍了表示关系操作的一种数学方法：关系代数

## 关系数据结构及形式化定义

### 关系

关系用来定义现实世界的实体、实体间的联系，也就是说**RDB的数据结构是非常单一**的，不仅实体是一种关系，联系也是一种关系。简单来说，关系是严格数学定义（集合论与关系代数）的表

关系的**逻辑结构**被称为关系模式，既然关系是表，那么关系模式就是表头

关于域、笛卡尔积、元组、分量、基数、度、关系、属性等简单概念就不再赘述

#### 关系的一些关键概念

##### 各种码/键（key）

**（超）码/键**是可以唯一表示元组的属性组，可以**最小唯一标识**的属性组被称为**候选码/键**，在这些候选码/键中选择一个作为使用的标识即可，规定作为标识的称为**主码/键**。

如果一个主码/键就是关系的**整个属性组**，那么被称为**全码/键**

候选码的属性被称为**主属性**，这一点需要注意，**并不只有主码的属性才叫主属性**

当一个实体**引用**了另一个实体的时候，需要将其**主码**作为自己的属性，被称为**外码/键**

##### 联系

联系分为1:1，1:n，m:n三种类型，都可以用外键来表示，但是m:n关系很容易导致冗余的出现，因此需要单独拆分出来一个关系表示一对m:n联系

#### 三类关系

在RDB中，存在三类关系：

- 基本关系（基本表）：也就是一张实际存在的表
- 查询表：对于基本表查询以后的结果汇聚为一张表
- 视图表：基本表或者其他试图表导出的虚表，没有实际的数据存储

这些内容在后面都有更详细的解释

#### 关系的性质

- 列同质：一个列的分量来自同一个域
- 不同列可以出自同一个域
- 列顺序可以交换
- 元组候选码不能相同
- 行顺序可以交换
- 分量必须取原子值（1NF）

### 关系模式

前面说过**模式是实例的型**，那么**关系模式其实就是关系的型**：关系模式相对稳定，关系是随时间变化的。当然，不那么严格的，有时候也会把关系模式成为关系，重点还是看上下文想表达的是这个型还是值

关系模式可以表示为
$$
R(U,D,DOM,F)
$$
其中R表示关系名，D是属性名集合，DOM是属性向域的映射集合，F是属性之间数据依赖关系的集合

不同的属性可能来自同一个域，也就是说U中的元素可能比D多，所以为了知道具体哪个属性出自哪个域，就需要DOM这个映射来表示

一半来说，我们也可以简记为：
$$
R(U)=R(A_1, A_2,...,A_n)
$$

### 关系数据库

所有关系的集合构成的数据库

其型为关系数据库模式Schema，是对其的描述；值是某一时刻对应的关系的集合

### 关系模型的存储结构

这一段说的比较笼统，关于物理存储，若一个表对应一个文件，则由操作系统进行物理数据的组织；若一个表对应多个文件，就需要DBMS自己进行存储管理。

## 关系操作

### 基本关系操作

基本关系操作按照是否改变了数据分为：查询、更新两类

查询操作有：选择、投影、连接、除、并、差、交、笛卡尔积；其中选择、投影、并、差、笛卡尔积是5种基本操作

也就是说，连接、除、交是导出操作。首先说连接，笛卡尔积可以导出连接，但是连接不能导出笛卡尔积，所以连接不算基本操作；除在后续会提到，这算是最复杂的关系操作了，所以也不算基本；交这个操作有点鸡肋，在选择的时候把筛选条件and起来就算是代替交了，所以也不是基本操作。

更新操作有：插入、删除、修改

关系操作采用**一次一集合**的方式，其对象与结果都是集合

### 关系数据库语言的分类

- **关系代数**语言用的就是关系运算来表示查询要求，代表为ISBL
- **关系演算**语言使用谓词表达，课程没有教授
- **结构化查询语言SQL**则结合了两者的特点

## 关系完整性

关系的完整性约束分为：实体完整性、参照完整性、用户定义的完整性。前两者称为关系的**两个不变性**

### 实体完整性

要求**主属性**非空（not NULL），因为主码唯一标识着实体，若主属性空，则说明实体不可区分。

### 参照完整性

倘若关系R通过外键F引用了关系S，那么F要么为S中某一个存在的元组的主码，要么为空

也就是说，**不允许引用不存在的实体**

### 用户定义的完整性

与具体的语义有关，需要用户的理解

## 关系代数

关系代数的运算对象和结果都是关系，分为：集合运算符（水平）、专门的关系运算符（行列都涉及）

![image-20221207230407140](/images/DBSNote/image-20221207230407140.png)

### 传统的集合运算

这部分比较容易理解，只需要确定两个关系要满足并相容（属性个数相同且所在的域一一对应）

### 专门的关系运算

#### 一些记号

- $t[A_i]$：元组$t$在属性$A_i$的分量
- $t[A]$：元组在属性组上的分量构成的子元组
- $Z_x$：象集，若有关系$R(X,Z)$，则$Z_x = \{ t[Z]|t\in R,t[X]=x\}$

#### 选择运算

又叫限制Restriction，指选出符合条件的元组，记为：
$$
\sigma _F (R) = \{t|t \in R \and F(t)=true\}
$$
$F$是选择的条件，基本形式为$X_1\Theta Y_1$，其中$\Theta$为比较运算符，如果存在嵌套的话，优先级从高到低为：括号、比较、非、与、或

#### 投影

Projection，选出一部分属性列来，记为：
$$
\pi _A (R) = \{t[A]|t \in R \}
$$

#### 连接（$\Theta$连接）

$$
R\underset{A\Theta B}\Join S = \{\overset{\frown}{t_r t_s}|t_r \in R \and t_s \in S \in t_r[A] \Theta t_s[B]\}
$$

也就是在两个关系的笛卡尔积中选择满足关系$\Theta$的关系

**等值连接：**当$\Theta$为等号的时候，成为等值连接

**自然连接：**在**同名**属性组上做等值连接，在结果中会把两个属性合并

**外连接：**

​	**悬浮元组：**R、S做自然连接的时候，R中可能存在一些S中没有对应的元组，这些元组在连接的时候就被舍弃了。

​	**外连接：**把悬浮元组保存在结果中，另一边赋值为NULL；若只保留左边关系的元组，就叫**左外连接**，反之叫**右外连接**。

#### 除运算

设$R(X,Y)$，$S(Y,Z)$借助之前象集的定义，除运算定义为：
$$
R\div S = \{t_r[X]| t_r \in R \and \pi _y (S)\in Y_x, x=t_r[X]\}
$$
也就是说，在关系$R$中给定一个$x$，$x$对应的$y$值必须要能够包含$S$中出现的所有$y$值

所以除法运算解决“查询...至少/全部的/所有的”这类问题很方便

除运算也可以不用象集定义：
$$
R\div S = \pi _x (R) - \pi_x((\pi_x(R)\times S)-R)
$$
举一个简单的例子，即可表示除运算的方便之处：

查询选修了所有课程的学生学号：$\pi_{Sno,Cno}(SC)\div \pi_{Cno}(Course)$

## 小结

关系数据库是目前最常用的数据库系统，本章按照数据模型的三大要素对其进行了介绍。

首先是关系数据结构，关系就是一张二维表，这也是关系数据库唯一的数据结构。具体而言，一个关系数据库中往往有三种表：基本表、查询表、试图表。

关系模式则用来表示关系的结构，是关系的型。

对于具体的物理存储，本章没有过多介绍，只说了可以一个基本表一个文件让OS管理、也可以建立多个文件让DBMS管理。



关系操作有查询、更新两类：

查询操作有：选择、投影、连接、除、并、差、交、笛卡尔积；其中选择、投影、并、差、笛卡尔积是5种基本操作

更新操作有：插入、修改、删除

描述关系操作的语言有：关系代数、关系演算、SQL。本章下面会重点讲解关系代数，SQL则会再后面单独开几章，关系演算则不在课程范围内。



关系完整性包含：实体完整性、参照完整性、用户定义的完整性。前两者为关系的两个不变性。



关系代数是一种以关系（集合）为对象和结果的关系操作表示方法，分为集合运算与关系运算。其中，关系运算主要包含了选择、投影、连接、除。连接的分类较多，包含$\Theta$连接、等值连接、自然连接、外连接等。