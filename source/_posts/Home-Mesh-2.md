---
layout: blog
title: 家庭Mesh组网（二）—— 家庭 Mesh 配置
date: 2024-08-07 00:17:12
categories: 不务正业の小玩意
tags: [网络, Mesh, 无线]
---

## 1. 家庭网络拓扑分析

设备介绍：

- GS3202：移动送的光猫，配置较差，只有1口是千兆，2-4口是百兆
- rt-ac66u：老华硕路由器，暂时接在百兆口苟延残喘，只能给我的房间提供网络
- e2633：据说是中兴 AX3000 巡天的运营商定制版，可以和中兴设备组网
- IPTV：父母用的电视机顶盒

需求主要两点：

- 把老华硕路由换掉，并和 E2633 组网，因此需要换成中兴的路由器
- IPTV 可以正常使用

<img src="/images/Home-Mesh-2/image-20240807002546154.png" alt="image-20240807002546154" style="zoom: 50%;" />

先介绍关于 IPTV 的内容：

如果 IPTV 和路由器都放在客厅电视柜的话，需要两根从客厅到弱电箱的网线分别连接千兆口（一般是1口）与路由器，电视口（一般是2口）与IPTV。

而之前家里装网络的电信师傅搞了一个很神奇的操作：把8芯的网线强行分成两个4芯，而4芯线的速度一般不到百兆，只能说操作非常难绷。

<img src="/images/Home-Mesh-2/image-20240807003538442.png" alt="image-20240807003538442" style="zoom:50%;" />

而第一张图中移动的装法则是把 IPTV 连接到了 E2633 路由器的 LAN 口上，并且在路由器和光猫中进行了一些设置如下。

超级管理员进入光猫后台可以看到 IPTV 业务的 VLAN ID 为 512，正常而言，绑定选项中的 LAN2 是勾选的，然后之间用 IPTV 机顶盒连接到光猫的 LAN2 就行。而这里用不到把它取消绑定了。

在绑定配置中，将 VLAN 512 绑定至 LAN1，实现对连接 E2633 路由器和光猫网线的复用。

![image-20240807005332174](/images/Home-Mesh-2/image-20240807005332174.png)

<img src="/images/Home-Mesh-2/image-20240807005057259.png" alt="image-20240807005057259" style="zoom:50%;" />

然后，在路由器中设置IPTV透传，这样就可以让 IPTV 机顶盒连接路由器 LAN1 来看电视。

![image-20240807090923306](/images/Home-Mesh-2/image-20240807090923306.png)

然而，设置完成后打开 IPTV 却没有网络。进入到路由器后台，看到 IPTV 的 IP 地址是 192.168.1.3，而一般 IPTV 的地址较为特殊，不太可能是这个。

经过排查，是因为路由器上网方式被设置为了桥接模式，路由器不会对网络流量进行 NAT 而是之间发送给光猫，而上面光猫设置的 DHCP Server 也没有启用，所以就没有设备给 IPTV 分配地址。而 DHCP 模式的路由器会向光猫请求 IP 地址并分配给光猫，使得光猫可以正常使用。

<img src="/images/Home-Mesh-2/image-20240807010031313.png" alt="image-20240807010031313" style="zoom:50%;" />

## 2. 方案选择

由于客厅和卧室到弱电箱的网线都只有一根，所以最简单的方案是：AX3000晴天是一种**壁挂式**路由，作为主路由挂在弱电箱旁边，然后直接可以连接客厅和卧室的子路由。

然而，经过多方咨询，了解到这种情况下 **IPTV 只能接到主路由的 LAN 口**，没有办法接到子路由的 LAN 口。因为如果 IPTV 要使用的话，主路由和子路由都要配置 IPTV 透传，那样主路由的 LAN1 口既要做 MESH，又要做 IPTV 透传，所以**不可用！**

<img src="/images/Home-Mesh-2/image-20240807091416567.png" alt="image-20240807091416567" style="zoom:50%;" />

而突发奇想的第二种方法是用旧华硕路由器关闭 WiFi 功能，或者是用软路由等，然后让两个中兴的路由器连接到上面做 AP Mesh。但是，同样也无法使用 IPTV。

<img src="/images/Home-Mesh-2/image-20240807091804810.png" alt="image-20240807091804810" style="zoom:50%;" />

所以为了这个 IPTV，就只能使用最复杂的 VLAN 方案了，使用两个水星 GS105 pro 网管交换机。1口作为 trunk，复用传输数据；2 口划入 VLAN2，负责光猫和主路由 WAN 口连接；3 口划入 VLAN3，负责主路由 LAN 口和副路由 WAN 口连接；4 口划入 VLAN4，负责光猫 IPTV 口和 IPTV 机顶盒连接。

注意这里我把 AX3000 巡天和 E2633 调换了位置，是因为标准版比定制版更适合作为主路由。

![image-20240807092605776](/images/Home-Mesh-2/image-20240807092605776.png)
