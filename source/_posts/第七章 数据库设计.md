---
title:  数据库原理第七章 关系数据库设计
date: 2022-12-17 20:27:02
categories: 数据库系统原理
tags: [数据库]
---

从名字就能看出来，这一章东西是比较多且杂的。

首先回顾一下第一章的数据模型：

- 概念模型存在于信息世界，是用户和分析人员的交流工具，本章很重要的E-R图就是概念模型的一种
- 数据模型是计算机世界中的模型，前面大费周章讲的关系模型就是数据模型

数据建模的过程是：**理解-区分-命名-表达**的过程

## 数据库设计概述

### 数据库设计的特点

（这里屁话比较多，主要是有两个定义

**元数据：**“数据的数据”，包括数据的来源、结构、编码规范、大小、格式等特征。

**主数据：**反映核心业务实体状态属性的企业基础信息，充分共享、高度复用。

数据库设计中，结构设计和行为设计要结合，不能够和传统的软件设计一样只注重行为、也不能够和早期数据库一样忽略了行为设计。

### 数据库的设计方法

主要采用基于E-R模型和3NF的设计方法

### 数据库设计的基本步骤

数据库设计的基本步骤分为如下六个阶段，但是要注意的是这六个阶段不是执行完就不管了，往往需要在实际中**不断重复、迭代**

1. 需求分析：数据字典、数据结构、数据流...
2. 概念结构设计：E-RD
3. 逻辑结构设计：关系模型
4. 物理结构设计：存取方法、存取路径
5. 数据库实施：创Schema、载入数据、试运行
6. 数据库运行和维护：性能检测、转储/恢复、重构

其中逻辑和物理设计与选择的DBMS关系密切

在数据库的设计人员中，有：

- 系统分析人员和数据库设计人员
- DBA和用户代表
- App开发人员

### 三个关键步骤的细粒度和内容

如下图所示，三种模型主要有如下区别：

- 概念模型支持多对多，但是逻辑模型以后则不能够有多对多，需要找一个中间的关联实体
- 概念模型找出键和主要属性，逻辑模型和物理模型再进一步找细节属性

![image-20221216221541230](E:\Blog\source\images\DBSNote\image-20221216221541230.png)

![image-20221216221742806](E:\Blog\source\images\DBSNote\image-20221216221742806.png)

### 数据库设计的各级模式

![image-20221216203053565](E:\Blog\source\images\DBSNote\image-20221216203053565.png)

- 如图所示，在需求分析阶段，综合分析各个要求，形成数据库的**概念模式**(E-R图)
- 然后将E-R图转化为关系模型等数据模型，成为**逻辑模式**
- 为了安全性、方便性的考虑，在逻辑模式的基础上，需要设计**外模式**
- 物理设计阶段，设计索引、存取路径等，也就是**内模式**

## 需求分析

这个阶段实操性太强，在PPT和书本上面很难讲述完备

### 需求分析的方法

调查步骤：

- 组织机构情况
- 各部门业务活动
- 用户要求
- 系统边界

调查方法：

- 观察
- 访谈
- 介绍
- 询问
- 问卷
- ...

分析方法：结构化分析方法SA，自顶向下逐层分解

### 数据字典

**内容：**包含数据项、数据结构、数据流、数据存储、处理过程

- 数据项：不可再分的数据单位
- 数据结构：若干个数据项、子数据结构组成
- 数据流：数据结构在系统内的传输路径
- 数据存储：数据流的来源和去向，数据结构停留存储的地方

## 概念结构设计

将用户需求抽象为概念模型，这里主要采用E-R模型

### E-R模型

注：本课程要求使用Crow's Foot表示E-R图。

E-R模型是一种表示关系及其联系的方法，在Crow's Foot方法中，使用矩形（圆角矩形）表示关系，并将关系的属性一并列在方框中。

Crow's Foot表示不仅可以表达1:1、1:n、m:n关系，还可以精确的表示是否包含0（是否是**完全参与**联系）

![image-20221216213911610](E:\Blog\source\images\DBSNote\image-20221216213911610.png)

### 概念结构设计

**1.实体和属性的划分原则**：实体有一系列不同的描述信息，属性不可分割、不能与其他实体有联系。**可以视为属性的尽量作为属性。**

**2.E-R图的合并：**

各个子系统的E-R图常常是分开设计，然后汇总到一起，难免存在冲突：

- 属性冲突：属性类型、属性单位不一致
- 命名冲突：同名异义、异名同义
- 结构冲突：有的局部中的实体在别的局部变成了属性、同一个实体的属性及属性排列不同、联系的类型不同

**3.消除冗余：**冗余的数据就是可以由其他数据导出的，可以看情况删除：存储与效率的tradeoff

## 逻辑结构设计

按照第一节表格中的说明，逻辑结构设计在把E-R图转化为关系模式以后，将属性识别完整、依据范式分解理论消除冗余，一般达到3NF即可。

### E-R图向关系模型的转换

逻辑结构设计的第一步就是把之前得到的E-R图转化为关系模型，转换原则如下：

1. 一个实体型转换为一个关系模式：

   - 一般的属性，稍作适应计算机系统的变化就可以了
   - 多值属性应该变成一个新的关系

2. 联系的转换：

   - 1:1联系，可以用外键表示、也可以用单独关系、**甚至可以合并关系**，具体选择方案需要看**强制性**：

     ![image-20221217114457014](E:\Blog\source\images\DBSNote\image-20221217114457014.png)

     - 如果两端都是强制性的：如果**根据实际应用需求**可以合并则合并；否则使用外键，外键可以在任意一端。
     - 如果一端强制、一端选择，那么一般将强制端作为选择端的外键，这样可以避免NULL外键的出现。
     - 如果两端都是选择，那么为了避免NULL出现，最好是把联系作为单独关系。

   - 1:n联系：一般情况下倾向于采用把1端作为n端的一个外键。

   - m:n联系：只能够转化为一个独立关系

   - 多元联系：也只能转化为一个独立关系

   **注：**后面还有一些概念，如弱实体、特化、概化、常见DB设计模式、编码设计等，似乎不是很会考

### 数据模型的优化

在初步得到了关系模型以后，需要根据具体DBMS、3NF规则等来进行优化。

优化方法：

1. 确定数据依赖
2. 对于各个关系模式之间的数据依赖进行极小化处理，消除冗余联系
3. 确定各个关系模式是第几范式
4. 按需求合并/分解范式，并不是规范程度越高就越好
5. 对关系模式进行必要分解，提高操作、存储效率：
   - 水平分解：将有不同特征的元组分开存，如经常使用的数据存在一个表、不经常使用的存在一个表。
   - 垂直分解：不常用、较大的属性拆分到另外一个表。

### 设计用户子模式

在第一节就讲过，设计好了模式以后，需要在模式上面设计外模式，主要包含：

- 使用别名，更符合用户的专业术语习惯
- 创建不同安全级别的视图
- 简化查询等用户操作

## 物理结构设计

确定存储结构、存取方法等，优化时空效率。

### 内容与方法

**准备：**了解应用环境、事务、DBMS特性

**选择参数：**查询的关系、属性、连接、投影的属性，更新的关系、属性等，以及各个事务的频率、性能要求等

**关系数据库设计中需要注意：**存取路径，关系、索引等的物理存储结构

### 存取方法的选择

常用的存取方法有：

- B+树索引存取
- Hash索引存取
- 聚簇存取

#### B+树索引存取

适用条件：

- 常常作为MAX、MIN的参数
- 作为连接条件
- 常需要排序

#### Hash索引存取

适用条件：等值连接/比较

#### 聚簇存取

按照某个属性（组）来存，在其上值相同的物理上连续存放，这个属性（组）叫做聚簇码。

**适用条件：**

- 很少增删、很少对变长列操作（否则维护开销非常巨大）
- 常按类型查询

### 反规范化设计

虽然大体是按照3NF来设计，但有时为了效率，需要增加一些冗余。

1. 水平分割：之前提到过，把常用元组和不常用元组放在不同表
2. 冗余字段：对于集中需要连接的字段
3. 派生字段：属性的计算表达式，如果经常需要查询就可以添加到属性里边，减少计算
4. 垂直分割：常要查询的列放一块，其他列放一块，减小IO

### 确定数据库的存储结构

**包含：**确定关系、索引、聚簇、日志、备份等的存储安排和存储结构，确定系统配置等

**考虑因素：**存取时间、存储空间利用率、维护代价，当然这三点常常是相互矛盾的，需要做好tradeoff

## 小结

本章大致介绍了数据库设计的整个流程：需求分析-概念结构设计-逻辑结构设计-物理结构设计。

需求分析是一个很实际的阶段，很难用理论描述详细，只是大致介绍了一些方法以及数据字典的概念。

概念结构设计是本章的一个重点，介绍了E-R图的画法。在概念结构设计的时候，需要表示出主键和关键属性。

逻辑结构设计也是一个重点，介绍了E-R图向关系模式转变的方法：

重点是联系的表示，根据联系种类的不同，有如下的方法：

- 一对一
  - 两端强制：可以合并，可以放在任意一边外键
  - 一端强制、一端选择：一般将强制端放在选择端作外键避免NULL
  - 两端选择：为了避免NULL采用中间关系
- 多对一：放在多端作为外键
- 多对多：只能作为单独关系

然后，需要根据范式分解理论，适当对范式进行分解消除冗余。

最后，需要在模式的基础上为用户设计外模式。

物理结构设计也不太好详细讲述，这里主要对比了三种存取方式的对比：B+树索引、Hash索引、聚簇。



